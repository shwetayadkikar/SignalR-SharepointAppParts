@model IEnumerable<SharePointPollAppWeb.Models.SurveyChartViewModel>

@{
    ViewBag.Title = "Survey Result";
}

<h2>Survey Result</h2>


@foreach (var item in Model)
{
    <div id="@item.SurveyId" style="float:left;width:100%" class="surveyChartWrapper">
        @Html.Partial("_SurveyResultChart", item)
    </div>
}
<div id="output" style="background-color:yellow;float:left;width:100%">

</div>
<input type="button" id="btnNext" value="Next >" style="margin:10px;float:right;" onclick="onNext()" />

@section scripts
{
    <link href="~/Content/toastr.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/highcharts.js"></script>
    <script src="~/Scripts/exporting.js"></script>
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script src="~/Scripts/toastr.min.js"></script>
    <script src="~/Scripts/SignalR.API.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            debugger;
            $(".surveyChartWrapper").hide();
            $(".surveyChartWrapper#1").show();
            SignalR_API.initReceiver();
            SignalR_API.startConnection(SignalR_API.addToGroup,'@ViewBag.GroupName');
        });


        function onNext() {
            debugger;
            var currentSuveyId = $(".surveyChartWrapper:Visible").attr('id');
            var nextSurveyId = parseInt(currentSuveyId) + 1;
            $(".surveyChartWrapper#" + currentSuveyId).hide();
            $(".surveyChartWrapper#" + nextSurveyId).show();
            var nextToNextSurveyId = parseInt(nextSurveyId) + 1;
            if ($(".surveyChartWrapper#" + nextToNextSurveyId).length > 0)
                $("#btnNext").show();
            else
                $("#btnNext").hide();
        }
    </script>
}